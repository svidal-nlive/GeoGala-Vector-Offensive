{"version":3,"file":"index.C3tsKPOc.js","sources":["../src/utils/constants.ts","../src/Renderer.ts","../src/GameState.ts","../src/InputHandler.ts","../src/utils/math.ts","../src/AudioManager.ts","../src/CollisionSystem.ts","../src/Entity.ts","../src/Player.ts","../src/Enemy.ts","../src/Bullet.ts","../src/utils/performance.ts","../src/WaveManager.ts","../src/LootManager.ts","../src/DamageCalculator.ts","../src/EffectManager.ts","../src/TouchControls.ts","../src/main.ts"],"sourcesContent":["// Game Constants & Configuration\r\n// WCAG AA verified colors, frame budget targets, input parameters\r\n\r\nexport const COLORS = {\r\n  bg: '#0b1020', // Deep navy (glassmorphic bg)\r\n  ship: '#00ff88', // Bright cyan\r\n  enemy: '#ff1744', // Neon red\r\n  bullet: '#ffeb3b', // Bright yellow\r\n  ui: '#e8f0ff', // Light blue-white (glassmorphic UI text)\r\n  uiMuted: '#b6c3ff', // Muted blue (secondary text)\r\n  accent: '#77e1ff', // Bright cyan accent\r\n  accent2: '#8b7bff', // Purple accent\r\n  warning: '#ff6b8b', // Soft red (warnings)\r\n  ok: '#7dffcf', // Mint green (success)\r\n} as const;\r\n\r\nexport const FRAME_BUDGET = {\r\n  target: 60, // FPS\r\n  maxFrameTime: 16.67, // ms (1000/60)\r\n  p95Threshold: 18, // ms (allow 1.33ms margin)\r\n  renderBudget: 12, // ms\r\n  updateBudget: 3, // ms\r\n  audioBudget: 2, // ms\r\n  reserveBudget: 1.67, // ms\r\n} as const;\r\n\r\nexport const INPUT = {\r\n  gamepadDeadzone: 0.15, // Radial deadzone (normalized)\r\n  pollInterval: 16.67, // ms (match 60 FPS)\r\n} as const;\r\n\r\nexport const AUDIO = {\r\n  contextType: 'AudioContext',\r\n  polyphonySfxLimit: 6, // Max simultaneous SFX sources\r\n  gainDuckingValue: 0.3, // Music gain when SFX playing\r\n  masterGain: 1.0, // Default master volume\r\n} as const;\r\n\r\nexport const ENTITY = {\r\n  playerPoolSize: 1,\r\n  enemyPoolSize: 15,\r\n  bulletPoolSize: 50,\r\n  totalPoolSize: 66, // 1 + 15 + 50\r\n} as const;\r\n\r\nexport const COLLISION = {\r\n  aabbBroadPhaseBudget: 3, // ms\r\n  spatialGridSize: 10, // Grid cells per axis\r\n} as const;\r\n\r\nexport const MOBILE = {\r\n  viewportFit: 'cover', // Enable safe-area-inset\r\n  orientationLock: 'portrait-primary',\r\n} as const;\r\n","// Canvas Renderer with DPR-aware Scaling\r\n\r\nimport { COLORS } from './utils/constants';\r\n\r\nexport class Renderer {\r\n  canvas: HTMLCanvasElement;\r\n  ctx: CanvasRenderingContext2D;\r\n  dpr: number;\r\n  width: number;\r\n  height: number;\r\n\r\n  constructor(canvasId: string) {\r\n    const canvas = document.getElementById(canvasId) as HTMLCanvasElement;\r\n    if (!canvas) {\r\n      throw new Error(`Canvas element with id \"${canvasId}\" not found`);\r\n    }\r\n\r\n    this.canvas = canvas;\r\n    this.ctx = canvas.getContext('2d')!;\r\n    this.dpr = window.devicePixelRatio || 1;\r\n\r\n    // Set logical size\r\n    this.width = canvas.clientWidth;\r\n    this.height = canvas.clientHeight;\r\n\r\n    // Set physical size (DPR-aware)\r\n    canvas.width = this.width * this.dpr;\r\n    canvas.height = this.height * this.dpr;\r\n\r\n    // Scale context for DPR\r\n    this.ctx.scale(this.dpr, this.dpr);\r\n\r\n    // Set styles\r\n    canvas.style.width = `${this.width}px`;\r\n    canvas.style.height = `${this.height}px`;\r\n  }\r\n\r\n  clear(): void {\r\n    this.ctx.fillStyle = COLORS.bg;\r\n    this.ctx.fillRect(0, 0, this.width, this.height);\r\n  }\r\n\r\n  drawTriangle(x: number, y: number, size: number, angle: number, fillColor: string): void {\r\n    this.ctx.save();\r\n    this.ctx.translate(x, y);\r\n    this.ctx.rotate(angle);\r\n\r\n    this.ctx.fillStyle = fillColor;\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, -size);\r\n    this.ctx.lineTo(size, size);\r\n    this.ctx.lineTo(-size, size);\r\n    this.ctx.closePath();\r\n    this.ctx.fill();\r\n\r\n    this.ctx.restore();\r\n  }\r\n\r\n  drawCircle(x: number, y: number, radius: number, fillColor: string): void {\r\n    this.ctx.fillStyle = fillColor;\r\n    this.ctx.beginPath();\r\n    this.ctx.arc(x, y, radius, 0, Math.PI * 2);\r\n    this.ctx.fill();\r\n  }\r\n\r\n  drawRect(x: number, y: number, width: number, height: number, fillColor: string): void {\r\n    this.ctx.fillStyle = fillColor;\r\n    this.ctx.fillRect(x, y, width, height);\r\n  }\r\n\r\n  drawText(text: string, x: number, y: number, size: number, color: string = COLORS.ui): void {\r\n    this.ctx.fillStyle = color;\r\n    this.ctx.font = `${size}px monospace`;\r\n    this.ctx.textAlign = 'left';\r\n    this.ctx.fillText(text, x, y);\r\n  }\r\n\r\n  drawTextCentered(text: string, x: number, y: number, size: number, color: string = COLORS.ui): void {\r\n    this.ctx.fillStyle = color;\r\n    this.ctx.font = `${size}px monospace`;\r\n    this.ctx.textAlign = 'center';\r\n    this.ctx.fillText(text, x, y);\r\n  }\r\n\r\n  getWidth(): number {\r\n    return this.width;\r\n  }\r\n\r\n  getHeight(): number {\r\n    return this.height;\r\n  }\r\n\r\n  getContext(): CanvasRenderingContext2D {\r\n    return this.ctx;\r\n  }\r\n}\r\n","// Game State Manager\r\n\r\nexport interface WorkshopUpgrade {\r\n  id: string;\r\n  name: string;\r\n  level: number;\r\n}\r\n\r\nexport class GameState {\r\n  wave = 0;\r\n  score = 0;\r\n  multiplier = 1.0;\r\n  comboCounter = 0;\r\n  noHitWave = true;\r\n  resources = {\r\n    scrap: 0,\r\n    synergy: 0,\r\n    rare: 0,\r\n  };\r\n  workshopUpgrades: Map<string, WorkshopUpgrade> = new Map();\r\n  isRunActive = false;\r\n  bestScore = 0;\r\n  runCount = 0;\r\n\r\n  constructor() {\r\n    this.loadWorkshopUpgrades();\r\n    this.loadRunStats();\r\n  }\r\n\r\n  startRun(): void {\r\n    this.wave = 1;\r\n    this.score = 0;\r\n    this.multiplier = 1.0;\r\n    this.comboCounter = 0;\r\n    this.noHitWave = true;\r\n    this.resources = { scrap: 0, synergy: 0, rare: 0 };\r\n    this.isRunActive = true;\r\n    this.runCount++;\r\n    this.saveRunStats();\r\n  }\r\n\r\n  endRun(): void {\r\n    this.isRunActive = false;\r\n    if (this.score > this.bestScore) {\r\n      this.bestScore = this.score;\r\n      this.saveRunStats();\r\n    }\r\n  }\r\n\r\n  nextWave(): void {\r\n    this.wave++;\r\n    this.multiplier = Math.min(2.0, 1.0 + (this.wave - 1) * 0.1); // Cap at 2.0x\r\n\r\n    // Bonus for no-hit waves\r\n    if (this.noHitWave) {\r\n      this.score = Math.floor(this.score * 1.1);\r\n    }\r\n    this.noHitWave = true; // Reset for next wave\r\n  }\r\n\r\n  onPlayerHit(): void {\r\n    this.noHitWave = false;\r\n  }\r\n\r\n  addScore(points: number): void {\r\n    this.score += Math.floor(points * this.multiplier);\r\n  }\r\n\r\n  addResources(type: keyof typeof this.resources, amount: number): void {\r\n    this.resources[type] += amount;\r\n  }\r\n\r\n  addWorkshopUpgrade(upgrade: WorkshopUpgrade): void {\r\n    this.workshopUpgrades.set(upgrade.id, upgrade);\r\n  }\r\n\r\n  getUpgrade(id: string): WorkshopUpgrade | undefined {\r\n    return this.workshopUpgrades.get(id);\r\n  }\r\n\r\n  saveWorkshopUpgrades(): void {\r\n    const data = Array.from(this.workshopUpgrades.values());\r\n    try {\r\n      localStorage.setItem('geogala_workshop', JSON.stringify(data));\r\n    } catch (e) {\r\n      console.error('Failed to save workshop upgrades:', e);\r\n    }\r\n  }\r\n\r\n  loadWorkshopUpgrades(): void {\r\n    try {\r\n      const data = localStorage.getItem('geogala_workshop');\r\n      if (data) {\r\n        const upgrades = JSON.parse(data) as WorkshopUpgrade[];\r\n        this.workshopUpgrades.clear();\r\n        upgrades.forEach((upgrade) => {\r\n          this.workshopUpgrades.set(upgrade.id, upgrade);\r\n        });\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load workshop upgrades:', e);\r\n      this.workshopUpgrades.clear();\r\n    }\r\n  }\r\n\r\n  clearRun(): void {\r\n    this.wave = 0;\r\n    this.score = 0;\r\n    this.multiplier = 1.0;\r\n    this.comboCounter = 0;\r\n    this.noHitWave = true;\r\n    this.resources = { scrap: 0, synergy: 0, rare: 0 };\r\n    this.isRunActive = false;\r\n  }\r\n\r\n  loadRunStats(): void {\r\n    try {\r\n      const data = localStorage.getItem('geogala_run_stats');\r\n      if (data) {\r\n        const stats = JSON.parse(data) as { bestScore: number; runCount: number };\r\n        this.bestScore = stats.bestScore || 0;\r\n        this.runCount = stats.runCount || 0;\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load run stats:', e);\r\n    }\r\n  }\r\n\r\n  saveRunStats(): void {\r\n    try {\r\n      const stats = { bestScore: this.bestScore, runCount: this.runCount };\r\n      localStorage.setItem('geogala_run_stats', JSON.stringify(stats));\r\n    } catch (e) {\r\n      console.error('Failed to save run stats:', e);\r\n    }\r\n  }\r\n}\r\n","// Input Handler (Keyboard, Gamepad, Pointer/Touch)\r\n\r\nimport { applyDeadzone } from './utils/math';\r\nimport { INPUT } from './utils/constants';\r\n\r\nexport class InputHandler {\r\n  private keyPressed: Set<string> = new Set();\r\n  private gamepadState = { x: 0, y: 0, fire: false };\r\n  private pointerState = { x: 0, y: 0, active: false, fire: false };\r\n  private canvas: HTMLCanvasElement;\r\n  private touchIdentifier: number | null = null;\r\n\r\n  constructor(canvas: HTMLCanvasElement) {\r\n    this.canvas = canvas;\r\n    this.setupKeyboardListeners();\r\n    this.setupPointerListeners();\r\n  }\r\n\r\n  private setupKeyboardListeners(): void {\r\n    window.addEventListener('keydown', (e) => {\r\n      this.keyPressed.add(e.key.toLowerCase());\r\n    });\r\n\r\n    window.addEventListener('keyup', (e) => {\r\n      this.keyPressed.delete(e.key.toLowerCase());\r\n    });\r\n  }\r\n\r\n  private setupPointerListeners(): void {\r\n    this.canvas.addEventListener('pointerdown', (e) => {\r\n      this.handlePointerStart(e);\r\n    });\r\n\r\n    this.canvas.addEventListener('pointermove', (e) => {\r\n      this.handlePointerMove(e);\r\n    });\r\n\r\n    this.canvas.addEventListener('pointerup', (e) => {\r\n      this.handlePointerEnd(e);\r\n    });\r\n\r\n    this.canvas.addEventListener('touchstart', (e) => {\r\n      if (e.touches.length > 0) {\r\n        this.touchIdentifier = e.touches[0].identifier;\r\n      }\r\n    });\r\n  }\r\n\r\n  private handlePointerStart(e: PointerEvent): void {\r\n    this.pointerState.active = true;\r\n    this.pointerState.x = e.clientX;\r\n    this.pointerState.y = e.clientY;\r\n    if (e.isPrimary) {\r\n      this.pointerState.fire = true;\r\n    }\r\n  }\r\n\r\n  private handlePointerMove(e: PointerEvent): void {\r\n    if (this.pointerState.active) {\r\n      this.pointerState.x = e.clientX;\r\n      this.pointerState.y = e.clientY;\r\n    }\r\n  }\r\n\r\n  private handlePointerEnd(e: PointerEvent): void {\r\n    if (e.isPrimary) {\r\n      this.pointerState.active = false;\r\n      this.pointerState.fire = false;\r\n    }\r\n  }\r\n\r\n  pollGamepad(): void {\r\n    const gamepads = navigator.getGamepads();\r\n    if (!gamepads || gamepads.length === 0) {\r\n      this.gamepadState = { x: 0, y: 0, fire: false };\r\n      return;\r\n    }\r\n\r\n    const gamepad = gamepads[0];\r\n    if (!gamepad || !gamepad.connected) {\r\n      this.gamepadState = { x: 0, y: 0, fire: false };\r\n      return;\r\n    }\r\n\r\n    // Left stick (axes 0, 1)\r\n    const [x, y] = applyDeadzone(gamepad.axes[0], gamepad.axes[1], INPUT.gamepadDeadzone);\r\n\r\n    // Fire button (Button 0 = A)\r\n    const fire = gamepad.buttons[0]?.pressed || false;\r\n\r\n    this.gamepadState = { x, y, fire };\r\n  }\r\n\r\n  getInput(): { x: number; y: number; fire: boolean } {\r\n    this.pollGamepad();\r\n\r\n    // Priority: gamepad > keyboard > pointer\r\n    if (this.gamepadState.x !== 0 || this.gamepadState.y !== 0) {\r\n      return {\r\n        x: this.gamepadState.x,\r\n        y: this.gamepadState.y,\r\n        fire: this.gamepadState.fire,\r\n      };\r\n    }\r\n\r\n    // Keyboard input\r\n    let kx = 0;\r\n    let ky = 0;\r\n    if (this.keyPressed.has('w') || this.keyPressed.has('arrowup')) ky -= 1;\r\n    if (this.keyPressed.has('s') || this.keyPressed.has('arrowdown')) ky += 1;\r\n    if (this.keyPressed.has('a') || this.keyPressed.has('arrowleft')) kx -= 1;\r\n    if (this.keyPressed.has('d') || this.keyPressed.has('arrowright')) kx += 1;\r\n\r\n    const kFire = this.keyPressed.has(' ');\r\n\r\n    if (kx !== 0 || ky !== 0) {\r\n      // Normalize keyboard input\r\n      const mag = Math.sqrt(kx * kx + ky * ky);\r\n      return {\r\n        x: kx / mag,\r\n        y: ky / mag,\r\n        fire: kFire,\r\n      };\r\n    }\r\n\r\n    // Pointer input (aim towards pointer)\r\n    if (this.pointerState.active) {\r\n      const rect = this.canvas.getBoundingClientRect();\r\n      const canvasCenterX = rect.width / 2;\r\n      const canvasCenterY = rect.height / 2;\r\n\r\n      const px = this.pointerState.x - rect.left - canvasCenterX;\r\n      const py = this.pointerState.y - rect.top - canvasCenterY;\r\n\r\n      const mag = Math.sqrt(px * px + py * py);\r\n      if (mag > 0) {\r\n        return {\r\n          x: px / mag,\r\n          y: py / mag,\r\n          fire: this.pointerState.fire,\r\n        };\r\n      }\r\n    }\r\n\r\n    return { x: 0, y: 0, fire: false };\r\n  }\r\n\r\n  isKeyPressed(key: string): boolean {\r\n    return this.keyPressed.has(key.toLowerCase());\r\n  }\r\n\r\n  shutdown(): void {\r\n    this.keyPressed.clear();\r\n    this.gamepadState = { x: 0, y: 0, fire: false };\r\n    this.pointerState = { x: 0, y: 0, active: false, fire: false };\r\n  }\r\n}\r\n","// Vector2 & Collision Mathematics\r\n\r\nexport class Vector2 {\r\n  x: number;\r\n  y: number;\r\n\r\n  constructor(x = 0, y = 0) {\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n\r\n  add(v: Vector2): Vector2 {\r\n    return new Vector2(this.x + v.x, this.y + v.y);\r\n  }\r\n\r\n  subtract(v: Vector2): Vector2 {\r\n    return new Vector2(this.x - v.x, this.y - v.y);\r\n  }\r\n\r\n  multiply(scalar: number): Vector2 {\r\n    return new Vector2(this.x * scalar, this.y * scalar);\r\n  }\r\n\r\n  magnitude(): number {\r\n    return Math.sqrt(this.x * this.x + this.y * this.y);\r\n  }\r\n\r\n  normalize(): Vector2 {\r\n    const mag = this.magnitude();\r\n    if (mag === 0) return new Vector2(0, 0);\r\n    return this.multiply(1 / mag);\r\n  }\r\n\r\n  dot(v: Vector2): number {\r\n    return this.x * v.x + this.y * v.y;\r\n  }\r\n\r\n  cross(v: Vector2): number {\r\n    return this.x * v.y - this.y * v.x;\r\n  }\r\n\r\n  copy(): Vector2 {\r\n    return new Vector2(this.x, this.y);\r\n  }\r\n}\r\n\r\n// AABB Collision Detection\r\nexport interface BoundingBox {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport function checkAABBCollision(a: BoundingBox, b: BoundingBox): boolean {\r\n  return (\r\n    a.x < b.x + b.width &&\r\n    a.x + a.width > b.x &&\r\n    a.y < b.y + b.height &&\r\n    a.y + a.height > b.y\r\n  );\r\n}\r\n\r\nexport function checkCircleCollision(\r\n  x1: number,\r\n  y1: number,\r\n  r1: number,\r\n  x2: number,\r\n  y2: number,\r\n  r2: number,\r\n): boolean {\r\n  const dx = x2 - x1;\r\n  const dy = y2 - y1;\r\n  const distSq = dx * dx + dy * dy;\r\n  const minDistSq = (r1 + r2) * (r1 + r2);\r\n  return distSq < minDistSq;\r\n}\r\n\r\n// Gamepad Deadzone (Radial)\r\nexport function applyDeadzone(x: number, y: number, deadzone: number): [number, number] {\r\n  const magnitude = Math.sqrt(x * x + y * y);\r\n\r\n  if (magnitude < deadzone) {\r\n    return [0, 0];\r\n  }\r\n\r\n  // Normalize to [0, 1] after deadzone\r\n  const normalized = (magnitude - deadzone) / (1 - deadzone);\r\n  const angle = Math.atan2(y, x);\r\n\r\n  return [Math.cos(angle) * normalized, Math.sin(angle) * normalized];\r\n}\r\n\r\n// Angle Normalization\r\nexport function normalizeAngle(angle: number): number {\r\n  return ((angle % (2 * Math.PI)) + 2 * Math.PI) % (2 * Math.PI);\r\n}\r\n\r\nexport function angleDifference(a: number, b: number): number {\r\n  let diff = b - a;\r\n  while (diff > Math.PI) diff -= 2 * Math.PI;\r\n  while (diff < -Math.PI) diff += 2 * Math.PI;\r\n  return diff;\r\n}\r\n","// Web Audio API Manager with SFX pooling and gain ducking\r\n\r\nimport { AUDIO } from './utils/constants';\r\n\r\ninterface SFXPool {\r\n  available: AudioBufferSourceNode[];\r\n  playing: Set<AudioBufferSourceNode>;\r\n}\r\n\r\nexport class AudioManager {\r\n  audioContext: AudioContext | null = null;\r\n  masterGain: GainNode | null = null;\r\n  musicGain: GainNode | null = null;\r\n  sfxGain: GainNode | null = null;\r\n  sfxPool: SFXPool = { available: [], playing: new Set() };\r\n  musicSource: AudioBufferSourceNode | null = null;\r\n  contextResumeAttempted = false;\r\n  \r\n  // Audio buffers (loaded on-demand)\r\n  buffers: Map<string, AudioBuffer> = new Map();\r\n  \r\n  // Ducking state\r\n  musicBaseGain = 0.5;\r\n  musicDuckedGain = 0.3;\r\n  duckingRampTime = 0.1; // seconds\r\n\r\n  constructor() {\r\n    this.tryInitContext();\r\n  }\r\n\r\n  private tryInitContext(): void {\r\n    try {\r\n      const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n      this.audioContext = audioContext;\r\n      \r\n      // Create gain nodes hierarchy\r\n      this.masterGain = audioContext.createGain();\r\n      this.masterGain.gain.value = AUDIO.masterGain;\r\n      this.masterGain.connect(audioContext.destination);\r\n      \r\n      // Music channel\r\n      this.musicGain = audioContext.createGain();\r\n      this.musicGain.gain.value = this.musicBaseGain;\r\n      this.musicGain.connect(this.masterGain);\r\n      \r\n      // SFX channel\r\n      this.sfxGain = audioContext.createGain();\r\n      this.sfxGain.gain.value = 0.8;\r\n      this.sfxGain.connect(this.masterGain);\r\n      \r\n      // Pre-allocate SFX pool\r\n      for (let i = 0; i < AUDIO.polyphonySfxLimit; i++) {\r\n        const source = audioContext.createBufferSource();\r\n        this.sfxPool.available.push(source);\r\n      }\r\n    } catch {\r\n      // AudioContext not supported\r\n    }\r\n  }\r\n\r\n  async resumeContext(): Promise<void> {\r\n    if (this.contextResumeAttempted || !this.audioContext) return;\r\n\r\n    this.contextResumeAttempted = true;\r\n\r\n    try {\r\n      if (this.audioContext.state === 'suspended') {\r\n        await this.audioContext.resume();\r\n      }\r\n    } catch {\r\n      // Failed to resume\r\n    }\r\n  }\r\n\r\n  async loadAudio(url: string): Promise<AudioBuffer | null> {\r\n    if (!this.audioContext) return null;\r\n\r\n    try {\r\n      const response = await window.fetch(url);\r\n      const arrayBuffer = await response.arrayBuffer();\r\n      return await this.audioContext.decodeAudioData(arrayBuffer);\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  async loadAndCacheAudio(key: string, url: string): Promise<void> {\r\n    if (this.buffers.has(key)) return;\r\n    const buffer = await this.loadAudio(url);\r\n    if (buffer) {\r\n      this.buffers.set(key, buffer);\r\n    }\r\n  }\r\n\r\n  playSfx(buffer: AudioBuffer): void {\r\n    if (!this.audioContext || !this.sfxGain) return;\r\n\r\n    // Get source from pool or create new\r\n    let source = this.sfxPool.available.pop();\r\n    if (!source) {\r\n      source = this.audioContext.createBufferSource();\r\n    }\r\n\r\n    source.buffer = buffer;\r\n    source.connect(this.sfxGain);\r\n    this.sfxPool.playing.add(source);\r\n    \r\n    // Duck music when SFX starts\r\n    this.applyMusicDucking(true);\r\n    \r\n    source.onended = () => {\r\n      this.sfxPool.playing.delete(source!);\r\n      this.sfxPool.available.push(source!);\r\n      \r\n      // Restore music gain when no SFX playing\r\n      if (this.sfxPool.playing.size === 0) {\r\n        this.applyMusicDucking(false);\r\n      }\r\n    };\r\n    \r\n    source.start();\r\n  }\r\n  \r\n  playSfxByKey(key: string): void {\r\n    const buffer = this.buffers.get(key);\r\n    if (buffer) {\r\n      this.playSfx(buffer);\r\n    }\r\n  }\r\n  \r\n  private applyMusicDucking(duck: boolean): void {\r\n    if (!this.musicGain || !this.audioContext) return;\r\n    \r\n    const targetGain = duck ? this.musicDuckedGain : this.musicBaseGain;\r\n    const currentTime = this.audioContext.currentTime;\r\n    \r\n    this.musicGain.gain.cancelScheduledValues(currentTime);\r\n    this.musicGain.gain.setValueAtTime(this.musicGain.gain.value, currentTime);\r\n    this.musicGain.gain.exponentialRampToValueAtTime(\r\n      targetGain,\r\n      currentTime + this.duckingRampTime,\r\n    );\r\n  }\r\n\r\n  playMusic(buffer: AudioBuffer, loop = true): void {\r\n    if (!this.audioContext || !this.musicGain) return;\r\n\r\n    if (this.musicSource) {\r\n      this.musicSource.stop();\r\n    }\r\n\r\n    this.musicSource = this.audioContext.createBufferSource();\r\n    this.musicSource.buffer = buffer;\r\n    this.musicSource.loop = loop;\r\n    this.musicSource.connect(this.musicGain);\r\n    this.musicSource.start();\r\n  }\r\n  \r\n  playMusicByKey(key: string, loop = true): void {\r\n    const buffer = this.buffers.get(key);\r\n    if (buffer) {\r\n      this.playMusic(buffer, loop);\r\n    }\r\n  }\r\n\r\n  stopMusic(): void {\r\n    if (this.musicSource) {\r\n      this.musicSource.stop();\r\n      this.musicSource = null;\r\n    }\r\n  }\r\n\r\n  setMasterGain(gain: number): void {\r\n    if (this.masterGain) {\r\n      this.masterGain.gain.value = Math.max(0, Math.min(1, gain));\r\n    }\r\n  }\r\n\r\n  getMasterGain(): number {\r\n    return this.masterGain?.gain.value || 0;\r\n  }\r\n\r\n  getContextState(): string {\r\n    return this.audioContext?.state || 'closed';\r\n  }\r\n}\r\n","// Collision Detection System (AABB Broad-Phase)\r\n\r\nimport { Entity } from './Entity';\r\nimport { checkCircleCollision } from './utils/math';\r\n\r\nexport interface CollisionPair {\r\n  a: Entity;\r\n  b: Entity;\r\n}\r\n\r\nexport class CollisionSystem {\r\n  private pairs: CollisionPair[] = [];\r\n\r\n  checkCollisions(entities: Entity[]): CollisionPair[] {\r\n    this.pairs = [];\r\n\r\n    for (let i = 0; i < entities.length; i++) {\r\n      if (!entities[i].alive) continue;\r\n\r\n      for (let j = i + 1; j < entities.length; j++) {\r\n        if (!entities[j].alive) continue;\r\n\r\n        if (this.checkCollision(entities[i], entities[j])) {\r\n          this.pairs.push({ a: entities[i], b: entities[j] });\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.pairs;\r\n  }\r\n\r\n  private checkCollision(a: Entity, b: Entity): boolean {\r\n    return checkCircleCollision(a.x, a.y, a.radius, b.x, b.y, b.radius);\r\n  }\r\n\r\n  getPairs(): CollisionPair[] {\r\n    return this.pairs;\r\n  }\r\n}\r\n","// Base Entity Class\r\n\r\nimport { Vector2 } from './utils/math';\r\n\r\nexport class Entity {\r\n  x = 0;\r\n  y = 0;\r\n  vx = 0;\r\n  vy = 0;\r\n  radius = 5;\r\n  alive = false;\r\n\r\n  constructor() {}\r\n\r\n  reset(x: number, y: number, vx: number, vy: number, radius: number = 5): void {\r\n    this.x = x;\r\n    this.y = y;\r\n    this.vx = vx;\r\n    this.vy = vy;\r\n    this.radius = radius;\r\n    this.alive = true;\r\n  }\r\n\r\n  deactivate(): void {\r\n    this.alive = false;\r\n  }\r\n\r\n  update(dt: number): void {\r\n    this.x += this.vx * dt;\r\n    this.y += this.vy * dt;\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D): void {\r\n    // Override in subclasses\r\n  }\r\n\r\n  getBoundingBox(): { x: number; y: number; width: number; height: number } {\r\n    return {\r\n      x: this.x - this.radius,\r\n      y: this.y - this.radius,\r\n      width: this.radius * 2,\r\n      height: this.radius * 2,\r\n    };\r\n  }\r\n}\r\n\r\n// Entity Pool for Object Reuse\r\nexport class EntityPool<T extends Entity> {\r\n  private pool: T[] = [];\r\n  private active: T[] = [];\r\n  private entityFactory: () => T;\r\n\r\n  constructor(size: number, factory: () => T) {\r\n    this.entityFactory = factory;\r\n    for (let i = 0; i < size; i++) {\r\n      this.pool.push(factory());\r\n    }\r\n  }\r\n\r\n  acquire(x: number, y: number, vx: number, vy: number, radius?: number): T | null {\r\n    let entity: T | undefined;\r\n\r\n    if (this.pool.length > 0) {\r\n      entity = this.pool.pop()!;\r\n    } else {\r\n      entity = this.entityFactory();\r\n    }\r\n\r\n    entity.reset(x, y, vx, vy, radius);\r\n    this.active.push(entity);\r\n    return entity;\r\n  }\r\n\r\n  release(entity: T): void {\r\n    entity.deactivate();\r\n    const index = this.active.indexOf(entity);\r\n    if (index > -1) {\r\n      this.active.splice(index, 1);\r\n      this.pool.push(entity);\r\n    }\r\n  }\r\n\r\n  getActive(): T[] {\r\n    return this.active;\r\n  }\r\n\r\n  clear(): void {\r\n    this.active.forEach((e) => {\r\n      e.deactivate();\r\n      this.pool.push(e);\r\n    });\r\n    this.active = [];\r\n  }\r\n\r\n  update(dt: number): void {\r\n    for (let i = this.active.length - 1; i >= 0; i--) {\r\n      const entity = this.active[i];\r\n      entity.update(dt);\r\n\r\n      // Remove off-screen entities\r\n      if (entity.x < -50 || entity.x > 800 || entity.y < -50 || entity.y > 600) {\r\n        this.release(entity);\r\n      }\r\n    }\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D): void {\r\n    this.active.forEach((e) => {\r\n      if (e.alive) {\r\n        e.draw(ctx);\r\n      }\r\n    });\r\n  }\r\n}\r\n","// Player Ship Entity\r\n\r\nimport { Entity } from './Entity';\r\nimport { COLORS } from './utils/constants';\r\n\r\nexport class Player extends Entity {\r\n  health = 100;\r\n  maxHealth = 100;\r\n  fireRate = 0.1; // seconds\r\n  timeSinceLastFire = 0;\r\n  aimAngle = 0;\r\n  maxSpeed = 450; // pixels/sec (Chicken Invaders style - faster, more responsive)\r\n  acceleration = 2200; // pixels/sec² (smooth acceleration)\r\n  deceleration = 1800; // pixels/sec² (smooth stop)\r\n  fireFlash = false;\r\n  damageFlashTimer = 0;\r\n  targetVx = 0;\r\n  targetVy = 0;\r\n\r\n  constructor() {\r\n    super();\r\n    this.radius = 15;\r\n  }\r\n\r\n  reset(x: number, y: number): void {\r\n    super.reset(x, y, 0, 0);\r\n    this.health = this.maxHealth;\r\n    this.timeSinceLastFire = 0;\r\n    this.aimAngle = 0;\r\n    this.fireFlash = false;\r\n    this.damageFlashTimer = 0;\r\n    this.targetVx = 0;\r\n    this.targetVy = 0;\r\n  }\r\n\r\n  update(dt: number): void {\r\n    // Smooth inertia-based movement (Chicken Invaders style)\r\n    // Accelerate towards target velocity\r\n    const dvx = this.targetVx - this.vx;\r\n    const dvy = this.targetVy - this.vy;\r\n    \r\n    if (Math.abs(dvx) > 0.1 || Math.abs(dvy) > 0.1) {\r\n      // Accelerating\r\n      const accelRate = this.acceleration * dt;\r\n      this.vx += Math.sign(dvx) * Math.min(Math.abs(dvx), accelRate);\r\n      this.vy += Math.sign(dvy) * Math.min(Math.abs(dvy), accelRate);\r\n    } else {\r\n      // Decelerate to stop\r\n      const decelRate = this.deceleration * dt;\r\n      if (Math.abs(this.vx) > decelRate) {\r\n        this.vx -= Math.sign(this.vx) * decelRate;\r\n      } else {\r\n        this.vx = 0;\r\n      }\r\n      if (Math.abs(this.vy) > decelRate) {\r\n        this.vy -= Math.sign(this.vy) * decelRate;\r\n      } else {\r\n        this.vy = 0;\r\n      }\r\n    }\r\n\r\n    // Apply movement\r\n    this.x += this.vx * dt;\r\n    this.y += this.vy * dt;\r\n    this.timeSinceLastFire += dt;\r\n\r\n    // Reset fire flash after 1 frame\r\n    if (this.fireFlash) {\r\n      this.fireFlash = false;\r\n    }\r\n\r\n    // Damage flash countdown\r\n    if (this.damageFlashTimer > 0) {\r\n      this.damageFlashTimer -= dt;\r\n    }\r\n  }\r\n\r\n  updateInput(inputX: number, inputY: number): void {\r\n    const inputMag = Math.sqrt(inputX * inputX + inputY * inputY);\r\n    if (inputMag > 0) {\r\n      // Set target velocity (normalized)\r\n      this.targetVx = (inputX / inputMag) * this.maxSpeed;\r\n      this.targetVy = (inputY / inputMag) * this.maxSpeed;\r\n      this.aimAngle = Math.atan2(inputY, inputX);\r\n    } else {\r\n      // No input - target is to stop\r\n      this.targetVx = 0;\r\n      this.targetVy = 0;\r\n    }\r\n  }\r\n\r\n  canFire(): boolean {\r\n    return this.timeSinceLastFire >= this.fireRate;\r\n  }\r\n\r\n  fire(): void {\r\n    this.timeSinceLastFire = 0;\r\n    this.fireFlash = true;\r\n  }\r\n\r\n  takeDamage(amount: number): void {\r\n    this.health = Math.max(0, this.health - amount);\r\n    this.damageFlashTimer = 0.2; // Flash red for 200ms\r\n    if (this.health <= 0) {\r\n      this.alive = false;\r\n    }\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D): void {\r\n    if (!this.alive) return;\r\n\r\n    ctx.save();\r\n    ctx.translate(this.x, this.y);\r\n\r\n    // Smooth rotation to aim angle (15 frames max)\r\n    ctx.rotate(this.aimAngle + Math.PI / 2);\r\n\r\n    // Fire flash - bright white glow\r\n    if (this.fireFlash) {\r\n      ctx.shadowColor = '#ffffff';\r\n      ctx.shadowBlur = 15;\r\n    }\r\n\r\n    // Damage flash - red tint\r\n    const damageFlashing = this.damageFlashTimer > 0 && Math.floor(this.damageFlashTimer * 10) % 2 === 0;\r\n    ctx.fillStyle = damageFlashing ? '#ff1744' : COLORS.ship;\r\n\r\n    // Draw ship triangle\r\n    ctx.beginPath();\r\n    ctx.moveTo(0, -this.radius);\r\n    ctx.lineTo(this.radius * 0.7, this.radius);\r\n    ctx.lineTo(-this.radius * 0.7, this.radius);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n\r\n    // Shield visual (when health > 50%)\r\n    if (this.health > this.maxHealth * 0.5) {\r\n      ctx.strokeStyle = 'rgba(0, 255, 136, 0.3)';\r\n      ctx.lineWidth = 2;\r\n      ctx.beginPath();\r\n      ctx.arc(0, 0, this.radius + 3, 0, Math.PI * 2);\r\n      ctx.stroke();\r\n    }\r\n\r\n    ctx.restore();\r\n  }\r\n}\r\n","// Enemy Entity with Faction AI\r\n\r\nimport { Entity } from './Entity';\r\nimport { COLORS } from './utils/constants';\r\n\r\nexport type Faction = 'triangle' | 'square' | 'hexagon' | 'diamond';\r\n\r\nexport class Enemy extends Entity {\r\n  faction: Faction = 'triangle';\r\n  health = 20;\r\n  maxHealth = 20;\r\n  fireRate = 0.5; // seconds\r\n  timeSinceLastFire = 0;\r\n  loot = { scrap: 10, synergy: 0, rare: 0 };\r\n  aiTimer = 0;\r\n  aiAngle = 0;\r\n  baseSpeed = 150;\r\n  damageFlashTimer = 0;\r\n  deathAnimTimer = 0;\r\n  isDying = false;\r\n\r\n  constructor(faction: Faction = 'triangle') {\r\n    super();\r\n    this.faction = faction;\r\n    this.radius = 12;\r\n    this.assignFactionStats();\r\n  }\r\n\r\n  private assignFactionStats(): void {\r\n    switch (this.faction) {\r\n    case 'triangle':\r\n      this.maxHealth = 20;\r\n      this.health = 20;\r\n      this.fireRate = 0.5;\r\n      this.loot = { scrap: 10, synergy: 0, rare: 0 };\r\n      break;\r\n    case 'square':\r\n      this.maxHealth = 30;\r\n      this.health = 30;\r\n      this.fireRate = 0.4;\r\n      this.loot = { scrap: 15, synergy: 1, rare: 0 };\r\n      break;\r\n    case 'hexagon':\r\n      this.maxHealth = 40;\r\n      this.health = 40;\r\n      this.fireRate = 0.3;\r\n      this.loot = { scrap: 20, synergy: 2, rare: 0 };\r\n      break;\r\n    case 'diamond':\r\n      this.maxHealth = 50;\r\n      this.health = 50;\r\n      this.fireRate = 0.2;\r\n      this.loot = { scrap: 25, synergy: 3, rare: 1 };\r\n      break;\r\n    }\r\n  }\r\n\r\n  reset(x: number, y: number, vx: number, vy: number): void {\r\n    super.reset(x, y, vx, vy);\r\n    this.health = this.maxHealth;\r\n    this.timeSinceLastFire = 0;\r\n    this.aiTimer = 0;\r\n    this.aiAngle = 0;\r\n    this.damageFlashTimer = 0;\r\n    this.deathAnimTimer = 0;\r\n    this.isDying = false;\r\n    this.assignFactionStats();\r\n  }\r\n\r\n  update(dt: number): void {\r\n    this.timeSinceLastFire += dt;\r\n    this.aiTimer += dt;\r\n\r\n    // Damage flash countdown\r\n    if (this.damageFlashTimer > 0) {\r\n      this.damageFlashTimer -= dt;\r\n    }\r\n\r\n    // Death animation\r\n    if (this.isDying) {\r\n      this.deathAnimTimer += dt;\r\n      if (this.deathAnimTimer >= 0.3) {\r\n        this.alive = false;\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Apply faction-specific AI patterns\r\n    this.updateAI(dt);\r\n\r\n    // Movement\r\n    this.x += this.vx * dt;\r\n    this.y += this.vy * dt;\r\n  }\r\n\r\n  private updateAI(dt: number): void {\r\n    switch (this.faction) {\r\n    case 'triangle':\r\n      // Linear downward movement (already set in reset)\r\n      break;\r\n    case 'square':\r\n      // Sinusoidal horizontal + downward\r\n      this.vx = Math.sin(this.aiTimer * 2) * 100;\r\n      this.vy = this.baseSpeed;\r\n      break;\r\n    case 'hexagon':\r\n      // Spiral descent\r\n      this.aiAngle += dt * 2;\r\n      this.vx = Math.cos(this.aiAngle) * 80;\r\n      this.vy = this.baseSpeed * 0.8;\r\n      break;\r\n    case 'diamond':\r\n      // Erratic movement (change angle every 1s)\r\n      if (this.aiTimer % 1.0 < dt) {\r\n        this.aiAngle = Math.random() * Math.PI * 2;\r\n      }\r\n      this.vx = Math.cos(this.aiAngle) * 120;\r\n      this.vy = Math.sin(this.aiAngle) * 60 + this.baseSpeed * 0.5;\r\n      break;\r\n    }\r\n  }\r\n\r\n  canFire(): boolean {\r\n    return this.timeSinceLastFire >= this.fireRate;\r\n  }\r\n\r\n  fire(): void {\r\n    this.timeSinceLastFire = 0;\r\n  }\r\n\r\n  takeDamage(amount: number): void {\r\n    this.health = Math.max(0, this.health - amount);\r\n    this.damageFlashTimer = 0.2; // Flash for 200ms\r\n    if (this.health <= 0) {\r\n      this.isDying = true;\r\n      this.deathAnimTimer = 0;\r\n    }\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D): void {\r\n    if (!this.alive) return;\r\n\r\n    ctx.save();\r\n    ctx.translate(this.x, this.y);\r\n\r\n    // Death animation - shrink and fade\r\n    if (this.isDying) {\r\n      const progress = this.deathAnimTimer / 0.3;\r\n      const scale = 1 - progress;\r\n      ctx.scale(scale, scale);\r\n      ctx.globalAlpha = 1 - progress;\r\n    }\r\n\r\n    // Damage flash - flicker every 50ms\r\n    const shouldFlash = this.damageFlashTimer > 0 && Math.floor(this.damageFlashTimer * 20) % 2 === 0;\r\n    ctx.fillStyle = shouldFlash ? '#ffffff' : COLORS.enemy;\r\n\r\n    switch (this.faction) {\r\n    case 'triangle':\r\n      this.drawTriangle(ctx);\r\n      break;\r\n    case 'square':\r\n      this.drawSquare(ctx);\r\n      break;\r\n    case 'hexagon':\r\n      this.drawHexagon(ctx);\r\n      break;\r\n    case 'diamond':\r\n      this.drawDiamond(ctx);\r\n      break;\r\n    }\r\n\r\n    ctx.restore();\r\n  }\r\n\r\n  private drawTriangle(ctx: CanvasRenderingContext2D): void {\r\n    // Pointing down\r\n    ctx.beginPath();\r\n    ctx.moveTo(0, this.radius);\r\n    ctx.lineTo(this.radius, -this.radius);\r\n    ctx.lineTo(-this.radius, -this.radius);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n\r\n    // White outline\r\n    ctx.strokeStyle = '#ffffff';\r\n    ctx.lineWidth = 1;\r\n    ctx.stroke();\r\n  }\r\n\r\n  private drawSquare(ctx: CanvasRenderingContext2D): void {\r\n    // Rotated 45 degrees\r\n    ctx.save();\r\n    ctx.rotate(Math.PI / 4);\r\n    ctx.fillRect(-this.radius, -this.radius, this.radius * 2, this.radius * 2);\r\n    \r\n    // White outline\r\n    ctx.strokeStyle = '#ffffff';\r\n    ctx.lineWidth = 1;\r\n    ctx.strokeRect(-this.radius, -this.radius, this.radius * 2, this.radius * 2);\r\n    ctx.restore();\r\n  }\r\n\r\n  private drawHexagon(ctx: CanvasRenderingContext2D): void {\r\n    ctx.beginPath();\r\n    for (let i = 0; i < 6; i++) {\r\n      const angle = (i / 6) * Math.PI * 2 - Math.PI / 2;\r\n      const x = Math.cos(angle) * this.radius;\r\n      const y = Math.sin(angle) * this.radius;\r\n      if (i === 0) ctx.moveTo(x, y);\r\n      else ctx.lineTo(x, y);\r\n    }\r\n    ctx.closePath();\r\n    ctx.fill();\r\n\r\n    // White outline\r\n    ctx.strokeStyle = '#ffffff';\r\n    ctx.lineWidth = 1;\r\n    ctx.stroke();\r\n  }\r\n\r\n  private drawDiamond(ctx: CanvasRenderingContext2D): void {\r\n    // Diamond on-point\r\n    ctx.beginPath();\r\n    ctx.moveTo(0, -this.radius);\r\n    ctx.lineTo(this.radius * 0.7, 0);\r\n    ctx.lineTo(0, this.radius);\r\n    ctx.lineTo(-this.radius * 0.7, 0);\r\n    ctx.closePath();\r\n    ctx.fill();\r\n\r\n    // White outline\r\n    ctx.strokeStyle = '#ffffff';\r\n    ctx.lineWidth = 1;\r\n    ctx.stroke();\r\n  }\r\n}\r\n","// Bullet Entity with Pooling\r\n\r\nimport { Entity } from './Entity';\r\nimport { COLORS } from './utils/constants';\r\n\r\nexport type BulletType = 'player' | 'enemy';\r\n\r\nexport class Bullet extends Entity {\r\n  bulletType: BulletType = 'player';\r\n  lifetime = 5; // seconds\r\n  timeAlive = 0;\r\n\r\n  constructor() {\r\n    super();\r\n    this.radius = 3;\r\n  }\r\n\r\n  reset(x: number, y: number, vx: number, vy: number, radius?: number): void {\r\n    super.reset(x, y, vx, vy, radius);\r\n    this.timeAlive = 0;\r\n  }\r\n\r\n  resetWithType(x: number, y: number, vx: number, vy: number, type: BulletType = 'player'): void {\r\n    this.reset(x, y, vx, vy);\r\n    this.bulletType = type;\r\n  }\r\n\r\n  update(dt: number): void {\r\n    super.update(dt);\r\n    this.timeAlive += dt;\r\n\r\n    // Expire after lifetime\r\n    if (this.timeAlive > this.lifetime) {\r\n      this.alive = false;\r\n    }\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D): void {\r\n    if (!this.alive) return;\r\n\r\n    ctx.fillStyle = this.bulletType === 'player' ? COLORS.bullet : COLORS.enemy;\r\n    ctx.beginPath();\r\n    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);\r\n    ctx.fill();\r\n  }\r\n}\r\n","// Performance Profiling & FPS Counter\r\n\r\nexport class PerformanceMonitor {\r\n  private frameTimes: number[] = [];\r\n  private fpsCounter = 0;\r\n  private lastFpsUpdate = 0;\r\n  private currentFps = 60;\r\n  private maxFrameTimeP95 = 16.67;\r\n  private readonly maxSamples = 300; // 5 seconds at 60 FPS\r\n\r\n  recordFrameTime(deltaTime: number): void {\r\n    this.frameTimes.push(deltaTime);\r\n    if (this.frameTimes.length > this.maxSamples) {\r\n      this.frameTimes.shift();\r\n    }\r\n  }\r\n\r\n  updateFps(currentTime: number): void {\r\n    this.fpsCounter++;\r\n\r\n    if (currentTime - this.lastFpsUpdate >= 1000) {\r\n      this.currentFps = this.fpsCounter;\r\n      this.fpsCounter = 0;\r\n      this.lastFpsUpdate = currentTime;\r\n      this.calculateP95();\r\n    }\r\n  }\r\n\r\n  private calculateP95(): void {\r\n    if (this.frameTimes.length === 0) return;\r\n\r\n    const sorted = [...this.frameTimes].sort((a, b) => a - b);\r\n    const p95Index = Math.ceil(sorted.length * 0.95) - 1;\r\n    this.maxFrameTimeP95 = sorted[p95Index];\r\n  }\r\n\r\n  getFps(): number {\r\n    return this.currentFps;\r\n  }\r\n\r\n  getP95FrameTime(): number {\r\n    return this.maxFrameTimeP95;\r\n  }\r\n\r\n  getAverageFrameTime(): number {\r\n    if (this.frameTimes.length === 0) return 0;\r\n    return this.frameTimes.reduce((a, b) => a + b, 0) / this.frameTimes.length;\r\n  }\r\n\r\n  isFrameBudgetExceeded(threshold = 18): boolean {\r\n    return this.maxFrameTimeP95 > threshold;\r\n  }\r\n\r\n  logMetrics(): string {\r\n    return `FPS: ${this.currentFps} | P95: ${this.maxFrameTimeP95.toFixed(2)}ms | Avg: ${this.getAverageFrameTime().toFixed(2)}ms`;\r\n  }\r\n}\r\n","// Wave Manager — Enemy spawn scheduling and wave progression\r\n\r\nimport { Enemy, Faction } from './Enemy';\r\nimport { EntityPool } from './Entity';\r\n\r\ninterface WavePattern {\r\n  faction: Faction;\r\n  count: number;\r\n  spawnDelay: number; // seconds between spawns\r\n}\r\n\r\ninterface WaveDefinition {\r\n  patterns: WavePattern[];\r\n  totalEnemies: number;\r\n}\r\n\r\nexport class WaveManager {\r\n  private currentWave = 0;\r\n  private enemiesSpawned = 0;\r\n  private enemiesAlive = 0;\r\n  private spawnTimer = 0;\r\n  private waveComplete = false;\r\n  private waveActive = false;\r\n  private currentPatternIndex = 0;\r\n  private patternSpawnCount = 0;\r\n\r\n  private waveDefinitions: Map<number, WaveDefinition> = new Map();\r\n\r\n  constructor() {\r\n    this.setupWaveDefinitions();\r\n  }\r\n\r\n  private setupWaveDefinitions(): void {\r\n    // Wave 1: 3 Triangles (starter)\r\n    this.waveDefinitions.set(1, {\r\n      patterns: [\r\n        { faction: 'triangle', count: 3, spawnDelay: 1.0 },\r\n      ],\r\n      totalEnemies: 3,\r\n    });\r\n\r\n    // Wave 2: 3 Squares + 2 Triangles\r\n    this.waveDefinitions.set(2, {\r\n      patterns: [\r\n        { faction: 'triangle', count: 2, spawnDelay: 0.8 },\r\n        { faction: 'square', count: 3, spawnDelay: 1.0 },\r\n      ],\r\n      totalEnemies: 5,\r\n    });\r\n\r\n    // Wave 3: 4 Triangles + 2 Squares\r\n    this.waveDefinitions.set(3, {\r\n      patterns: [\r\n        { faction: 'triangle', count: 4, spawnDelay: 0.7 },\r\n        { faction: 'square', count: 2, spawnDelay: 0.9 },\r\n      ],\r\n      totalEnemies: 6,\r\n    });\r\n\r\n    // Wave 4: 2 Hexagons + 3 Squares + 2 Triangles\r\n    this.waveDefinitions.set(4, {\r\n      patterns: [\r\n        { faction: 'triangle', count: 2, spawnDelay: 0.6 },\r\n        { faction: 'square', count: 3, spawnDelay: 0.8 },\r\n        { faction: 'hexagon', count: 2, spawnDelay: 1.2 },\r\n      ],\r\n      totalEnemies: 7,\r\n    });\r\n\r\n    // Wave 5: 1 Diamond + 3 Hexagons + 4 Triangles\r\n    this.waveDefinitions.set(5, {\r\n      patterns: [\r\n        { faction: 'triangle', count: 4, spawnDelay: 0.5 },\r\n        { faction: 'hexagon', count: 3, spawnDelay: 1.0 },\r\n        { faction: 'diamond', count: 1, spawnDelay: 1.5 },\r\n      ],\r\n      totalEnemies: 8,\r\n    });\r\n  }\r\n\r\n  startWave(waveNum: number): void {\r\n    this.currentWave = waveNum;\r\n    this.enemiesSpawned = 0;\r\n    this.enemiesAlive = 0;\r\n    this.spawnTimer = 0;\r\n    this.waveComplete = false;\r\n    this.waveActive = true;\r\n    this.currentPatternIndex = 0;\r\n    this.patternSpawnCount = 0;\r\n  }\r\n\r\n  update(dt: number, enemyPool: EntityPool<Enemy>, canvasWidth: number): void {\r\n    if (!this.waveActive) return;\r\n\r\n    const waveDef = this.waveDefinitions.get(this.currentWave);\r\n    if (!waveDef) {\r\n      this.waveComplete = true;\r\n      this.waveActive = false;\r\n      return;\r\n    }\r\n\r\n    // Check if all enemies spawned\r\n    if (this.enemiesSpawned >= waveDef.totalEnemies) {\r\n      // Check if wave is complete (all enemies dead)\r\n      if (this.enemiesAlive <= 0) {\r\n        this.waveComplete = true;\r\n        this.waveActive = false;\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Spawn enemies based on pattern\r\n    this.spawnTimer += dt;\r\n\r\n    const currentPattern = waveDef.patterns[this.currentPatternIndex];\r\n    if (!currentPattern) return;\r\n\r\n    if (this.spawnTimer >= currentPattern.spawnDelay) {\r\n      this.spawnTimer = 0;\r\n\r\n      // Spawn enemy\r\n      const spawnX = canvasWidth * (0.2 + Math.random() * 0.6); // Random horizontal position\r\n      const spawnY = -20; // Above screen\r\n      const enemy = enemyPool.acquire(spawnX, spawnY, 0, 150); // Move down at 150 px/s\r\n\r\n      if (enemy) {\r\n        enemy.faction = currentPattern.faction;\r\n        enemy.reset(spawnX, spawnY, 0, 150);\r\n        this.enemiesSpawned++;\r\n        this.enemiesAlive++;\r\n        this.patternSpawnCount++;\r\n\r\n        // Move to next pattern if current pattern complete\r\n        if (this.patternSpawnCount >= currentPattern.count) {\r\n          this.currentPatternIndex++;\r\n          this.patternSpawnCount = 0;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  onEnemyDeath(): void {\r\n    this.enemiesAlive = Math.max(0, this.enemiesAlive - 1);\r\n  }\r\n\r\n  isWaveComplete(): boolean {\r\n    return this.waveComplete;\r\n  }\r\n\r\n  isWaveActive(): boolean {\r\n    return this.waveActive;\r\n  }\r\n\r\n  getWaveNumber(): number {\r\n    return this.currentWave;\r\n  }\r\n\r\n  getWaveProgress(): { spawned: number; alive: number; total: number } {\r\n    const waveDef = this.waveDefinitions.get(this.currentWave);\r\n    return {\r\n      spawned: this.enemiesSpawned,\r\n      alive: this.enemiesAlive,\r\n      total: waveDef ? waveDef.totalEnemies : 0,\r\n    };\r\n  }\r\n}\r\n","// Loot Manager — Resource drops and collection\r\n\r\nimport { Player } from './Player';\r\n\r\nexport type LootType = 'scrap' | 'synergy' | 'rare';\r\n\r\nexport interface LootDrop {\r\n  x: number;\r\n  y: number;\r\n  vx: number;\r\n  vy: number;\r\n  radius: number;\r\n  alive: boolean;\r\n  lootType: LootType;\r\n  amount: number;\r\n  lifetime: number;\r\n  reset(_nx: number, _ny: number, _nvx: number, _nvy: number): void;\r\n  update(_dt: number): void;\r\n  draw(_ctx: CanvasRenderingContext2D): void;\r\n}\r\n\r\nexport class LootManager {\r\n  private lootDrops: LootDrop[] = [];\r\n  private readonly PICKUP_RANGE = 50; // Auto-collect within player radius + 50px\r\n  private readonly MAX_LIFETIME = 10; // Loot disappears after 10 seconds\r\n\r\n  spawnLoot(x: number, y: number, type: LootType, amount: number): void {\r\n    const maxLifetime = this.MAX_LIFETIME;\r\n    const loot: LootDrop = {\r\n      x,\r\n      y,\r\n      vx: 0,\r\n      vy: 0,\r\n      radius: 5,\r\n      alive: true,\r\n      lootType: type,\r\n      amount,\r\n      lifetime: 0,\r\n      reset(nx: number, ny: number, nvx: number, nvy: number): void {\r\n        this.x = nx;\r\n        this.y = ny;\r\n        this.vx = nvx;\r\n        this.vy = nvy;\r\n        this.alive = true;\r\n        this.lifetime = 0;\r\n      },\r\n      update(dt: number): void {\r\n        this.x += this.vx * dt;\r\n        this.y += this.vy * dt;\r\n        this.lifetime += dt;\r\n        if (this.lifetime >= maxLifetime) {\r\n          this.alive = false;\r\n        }\r\n      },\r\n      draw(ctx: CanvasRenderingContext2D): void {\r\n        if (!this.alive) return;\r\n        ctx.save();\r\n        ctx.fillStyle = type === 'scrap' ? '#FFD700' : type === 'synergy' ? '#00BFFF' : '#FF00FF';\r\n        ctx.beginPath();\r\n        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        ctx.restore();\r\n      },\r\n    };\r\n\r\n    this.lootDrops.push(loot);\r\n  }\r\n\r\n  update(dt: number): void {\r\n    this.lootDrops.forEach((loot) => loot.update(dt));\r\n    this.lootDrops = this.lootDrops.filter((loot) => loot.alive);\r\n  }\r\n\r\n  collectLoot(player: Player, onCollect: (_type: LootType, _amount: number) => void): void {\r\n    const collectRange = player.radius + this.PICKUP_RANGE;\r\n\r\n    this.lootDrops.forEach((loot) => {\r\n      if (!loot.alive) return;\r\n\r\n      const dx = loot.x - player.x;\r\n      const dy = loot.y - player.y;\r\n      const dist = Math.sqrt(dx * dx + dy * dy);\r\n\r\n      if (dist < collectRange) {\r\n        onCollect(loot.lootType, loot.amount);\r\n        loot.alive = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D): void {\r\n    this.lootDrops.forEach((loot) => loot.draw(ctx));\r\n  }\r\n\r\n  clear(): void {\r\n    this.lootDrops = [];\r\n  }\r\n\r\n  getActiveLoot(): LootDrop[] {\r\n    return this.lootDrops.filter((loot) => loot.alive);\r\n  }\r\n}\r\n","// Damage Calculator — Hit damage resolution\r\n\r\nimport { Player } from './Player';\r\nimport { Enemy } from './Enemy';\r\nimport { Bullet } from './Bullet';\r\n\r\nexport class DamageCalculator {\r\n  private damageThisFrame: Set<string> = new Set();\r\n\r\n  // Reset frame tracking (call at start of each frame)\r\n  resetFrame(): void {\r\n    this.damageThisFrame.clear();\r\n  }\r\n\r\n  // Apply damage for player bullet hitting enemy\r\n  applyPlayerBulletDamage(bullet: Bullet, enemy: Enemy): void {\r\n    const key = `bullet-${bullet.x}-${bullet.y}-enemy-${enemy.x}-${enemy.y}`;\r\n    if (this.damageThisFrame.has(key)) return;\r\n\r\n    enemy.takeDamage(10); // Player bullets do 10 damage\r\n    bullet.alive = false; // Remove bullet on hit\r\n    this.damageThisFrame.add(key);\r\n  }\r\n\r\n  // Apply damage for enemy bullet hitting player\r\n  applyEnemyBulletDamage(bullet: Bullet, player: Player): void {\r\n    const key = `bullet-${bullet.x}-${bullet.y}-player`;\r\n    if (this.damageThisFrame.has(key)) return;\r\n\r\n    player.takeDamage(5); // Enemy bullets do 5 damage\r\n    bullet.alive = false; // Remove bullet on hit\r\n    this.damageThisFrame.add(key);\r\n  }\r\n\r\n  // Apply damage for enemy collision with player\r\n  applyEnemyCollisionDamage(enemy: Enemy, player: Player): void {\r\n    const key = `enemy-${enemy.x}-${enemy.y}-player`;\r\n    if (this.damageThisFrame.has(key)) return;\r\n\r\n    player.takeDamage(10); // Enemy collision does 10 damage\r\n    enemy.takeDamage(enemy.maxHealth); // Kill enemy on collision\r\n    this.damageThisFrame.add(key);\r\n  }\r\n}\r\n","// Particle Effect System\r\n\r\ninterface Particle {\r\n  x: number;\r\n  y: number;\r\n  vx: number;\r\n  vy: number;\r\n  lifetime: number;\r\n  maxLifetime: number;\r\n  color: string;\r\n  size: number;\r\n  alive: boolean;\r\n}\r\n\r\nexport class EffectManager {\r\n  private particles: Particle[] = [];\r\n  private readonly MAX_PARTICLES = 100;\r\n\r\n  spawnExplosion(x: number, y: number, color: string = '#ff1744', count: number = 6): void {\r\n    for (let i = 0; i < count; i++) {\r\n      if (this.particles.length >= this.MAX_PARTICLES) break;\r\n\r\n      const angle = (i / count) * Math.PI * 2;\r\n      const speed = 100 + Math.random() * 100;\r\n\r\n      const particle: Particle = {\r\n        x,\r\n        y,\r\n        vx: Math.cos(angle) * speed,\r\n        vy: Math.sin(angle) * speed,\r\n        lifetime: 0,\r\n        maxLifetime: 0.3 + Math.random() * 0.2,\r\n        color,\r\n        size: 2 + Math.random() * 2,\r\n        alive: true,\r\n      };\r\n\r\n      this.particles.push(particle);\r\n    }\r\n  }\r\n\r\n  update(dt: number): void {\r\n    this.particles.forEach((p) => {\r\n      if (!p.alive) return;\r\n\r\n      p.x += p.vx * dt;\r\n      p.y += p.vy * dt;\r\n      p.lifetime += dt;\r\n\r\n      // Fade out\r\n      if (p.lifetime >= p.maxLifetime) {\r\n        p.alive = false;\r\n      }\r\n    });\r\n\r\n    // Remove dead particles\r\n    this.particles = this.particles.filter((p) => p.alive);\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D): void {\r\n    this.particles.forEach((p) => {\r\n      if (!p.alive) return;\r\n\r\n      const alpha = 1 - p.lifetime / p.maxLifetime;\r\n      ctx.save();\r\n      ctx.globalAlpha = alpha;\r\n      ctx.fillStyle = p.color;\r\n      ctx.beginPath();\r\n      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);\r\n      ctx.fill();\r\n      ctx.restore();\r\n    });\r\n  }\r\n\r\n  clear(): void {\r\n    this.particles = [];\r\n  }\r\n\r\n  getParticleCount(): number {\r\n    return this.particles.length;\r\n  }\r\n}\r\n","// Touch Controls for Mobile (Virtual Joystick)\r\n\r\nexport interface TouchInput {\r\n  x: number;\r\n  y: number;\r\n  fire: boolean;\r\n}\r\n\r\nexport class TouchControls {\r\n  private canvas: HTMLCanvasElement;\r\n  private joystickActive = false;\r\n  private joystickStartX = 0;\r\n  private joystickStartY = 0;\r\n  private joystickCurrentX = 0;\r\n  private joystickCurrentY = 0;\r\n  private joystickRadius = 50;\r\n  private joystickMaxDistance = 40;\r\n  private fireButtonActive = false;\r\n  private touchIdJoystick: number | null = null;\r\n  private touchIdFire: number | null = null;\r\n  \r\n  input: TouchInput = { x: 0, y: 0, fire: false };\r\n\r\n  constructor(canvas: HTMLCanvasElement) {\r\n    this.canvas = canvas;\r\n    this.setupEventListeners();\r\n  }\r\n\r\n  private setupEventListeners(): void {\r\n    this.canvas.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: false });\r\n    this.canvas.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });\r\n    this.canvas.addEventListener('touchend', this.handleTouchEnd.bind(this), { passive: false });\r\n    this.canvas.addEventListener('touchcancel', this.handleTouchEnd.bind(this), { passive: false });\r\n  }\r\n\r\n  private handleTouchStart(e: unknown): void {\r\n    const touchEvent = e as { preventDefault: () => void; changedTouches: { identifier: number; clientX: number; clientY: number }[] };\r\n    touchEvent.preventDefault();\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    \r\n    for (let i = 0; i < touchEvent.changedTouches.length; i++) {\r\n      const touch = touchEvent.changedTouches[i];\r\n      const x = touch.clientX - rect.left;\r\n      const y = touch.clientY - rect.top;\r\n      \r\n      // Left half = joystick, right half = fire button\r\n      if (x < rect.width / 2 && this.touchIdJoystick === null) {\r\n        this.touchIdJoystick = touch.identifier;\r\n        this.joystickActive = true;\r\n        this.joystickStartX = x;\r\n        this.joystickStartY = y;\r\n        this.joystickCurrentX = x;\r\n        this.joystickCurrentY = y;\r\n      } else if (x >= rect.width / 2 && this.touchIdFire === null) {\r\n        this.touchIdFire = touch.identifier;\r\n        this.fireButtonActive = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleTouchMove(e: unknown): void {\r\n    const touchEvent = e as { preventDefault: () => void; changedTouches: { identifier: number; clientX: number; clientY: number }[] };\r\n    touchEvent.preventDefault();\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    \r\n    for (let i = 0; i < touchEvent.changedTouches.length; i++) {\r\n      const touch = touchEvent.changedTouches[i];\r\n      \r\n      if (touch.identifier === this.touchIdJoystick) {\r\n        this.joystickCurrentX = touch.clientX - rect.left;\r\n        this.joystickCurrentY = touch.clientY - rect.top;\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleTouchEnd(e: unknown): void {\r\n    const touchEvent = e as { preventDefault: () => void; changedTouches: { identifier: number }[] };\r\n    touchEvent.preventDefault();\r\n    \r\n    for (let i = 0; i < touchEvent.changedTouches.length; i++) {\r\n      const touch = touchEvent.changedTouches[i];\r\n      \r\n      if (touch.identifier === this.touchIdJoystick) {\r\n        this.joystickActive = false;\r\n        this.touchIdJoystick = null;\r\n        this.input.x = 0;\r\n        this.input.y = 0;\r\n      } else if (touch.identifier === this.touchIdFire) {\r\n        this.fireButtonActive = false;\r\n        this.touchIdFire = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  update(): void {\r\n    if (this.joystickActive) {\r\n      const dx = this.joystickCurrentX - this.joystickStartX;\r\n      const dy = this.joystickCurrentY - this.joystickStartY;\r\n      const distance = Math.sqrt(dx * dx + dy * dy);\r\n      \r\n      if (distance > 5) {\r\n        const clampedDistance = Math.min(distance, this.joystickMaxDistance);\r\n        this.input.x = (dx / distance) * (clampedDistance / this.joystickMaxDistance);\r\n        this.input.y = (dy / distance) * (clampedDistance / this.joystickMaxDistance);\r\n      } else {\r\n        this.input.x = 0;\r\n        this.input.y = 0;\r\n      }\r\n    }\r\n    \r\n    this.input.fire = this.fireButtonActive;\r\n  }\r\n\r\n  draw(ctx: CanvasRenderingContext2D): void {\r\n    if (!this.joystickActive && !this.fireButtonActive) return;\r\n    \r\n    ctx.save();\r\n    \r\n    // Draw joystick\r\n    if (this.joystickActive) {\r\n      // Outer circle\r\n      ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';\r\n      ctx.lineWidth = 2;\r\n      ctx.beginPath();\r\n      ctx.arc(this.joystickStartX, this.joystickStartY, this.joystickRadius, 0, Math.PI * 2);\r\n      ctx.stroke();\r\n      \r\n      // Inner stick\r\n      ctx.fillStyle = 'rgba(0, 255, 136, 0.6)';\r\n      ctx.beginPath();\r\n      ctx.arc(this.joystickCurrentX, this.joystickCurrentY, 20, 0, Math.PI * 2);\r\n      ctx.fill();\r\n    }\r\n    \r\n    // Draw fire button (right side)\r\n    if (this.fireButtonActive) {\r\n      const fireX = ctx.canvas.width - 80;\r\n      const fireY = ctx.canvas.height - 80;\r\n      \r\n      ctx.fillStyle = 'rgba(255, 23, 68, 0.6)';\r\n      ctx.beginPath();\r\n      ctx.arc(fireX, fireY, 40, 0, Math.PI * 2);\r\n      ctx.fill();\r\n      \r\n      ctx.strokeStyle = 'rgba(255, 255, 255, 0.4)';\r\n      ctx.lineWidth = 2;\r\n      ctx.beginPath();\r\n      ctx.arc(fireX, fireY, 40, 0, Math.PI * 2);\r\n      ctx.stroke();\r\n    }\r\n    \r\n    ctx.restore();\r\n  }\r\n}\r\n","// Game Loop Entry Point (RAF-based with delta-time)\r\n\r\nimport { Renderer } from './Renderer';\r\nimport { GameState } from './GameState';\r\nimport { InputHandler } from './InputHandler';\r\nimport { AudioManager } from './AudioManager';\r\nimport { CollisionSystem } from './CollisionSystem';\r\nimport { Player } from './Player';\r\nimport { Enemy } from './Enemy';\r\nimport { Bullet } from './Bullet';\r\nimport { EntityPool } from './Entity';\r\nimport { PerformanceMonitor } from './utils/performance';\r\nimport { COLORS, FRAME_BUDGET, ENTITY } from './utils/constants';\r\nimport { WaveManager } from './WaveManager';\r\nimport { LootManager } from './LootManager';\r\nimport { DamageCalculator } from './DamageCalculator';\r\nimport { EffectManager } from './EffectManager';\r\nimport { TouchControls } from './TouchControls';\r\n\r\nclass Game {\r\n  renderer: Renderer;\r\n  gameState: GameState;\r\n  inputHandler: InputHandler;\r\n  touchControls: TouchControls;\r\n  audioManager: AudioManager;\r\n  collisionSystem: CollisionSystem;\r\n  performanceMonitor: PerformanceMonitor;\r\n  waveManager: WaveManager;\r\n  lootManager: LootManager;\r\n  damageCalculator: DamageCalculator;\r\n  effectManager: EffectManager;\r\n\r\n  playerPool: EntityPool<Player>;\r\n  enemyPool: EntityPool<Enemy>;\r\n  bulletPool: EntityPool<Bullet>;\r\n\r\n  player: Player | null = null;\r\n  debugMode = false;\r\n  lastFrameTime = 0;\r\n  waveTransitionTimer = 0;\r\n  gameOverTimer = 0;\r\n  isGameOver = false;\r\n  showWaveTransition = false;\r\n  waveTransitionFade = 0;\r\n\r\n  constructor() {\r\n    this.renderer = new Renderer('game');\r\n    this.gameState = new GameState();\r\n    this.inputHandler = new InputHandler(this.renderer.canvas);\r\n    this.touchControls = new TouchControls(this.renderer.canvas);\r\n    this.audioManager = new AudioManager();\r\n    this.collisionSystem = new CollisionSystem();\r\n    this.performanceMonitor = new PerformanceMonitor();\r\n    this.waveManager = new WaveManager();\r\n    this.lootManager = new LootManager();\r\n    this.damageCalculator = new DamageCalculator();\r\n    this.effectManager = new EffectManager();\r\n\r\n    // Initialize entity pools\r\n    this.playerPool = new EntityPool(ENTITY.playerPoolSize, () => new Player());\r\n    this.enemyPool = new EntityPool(ENTITY.enemyPoolSize, () => new Enemy());\r\n    this.bulletPool = new EntityPool(ENTITY.bulletPoolSize, () => new Bullet());\r\n\r\n    // Spawn player\r\n    this.player = this.playerPool.acquire(\r\n      this.renderer.getWidth() / 2,\r\n      this.renderer.getHeight() - 50,\r\n      0,\r\n      0,\r\n    );\r\n\r\n    // Setup events\r\n    this.setupKeyboardEvents();\r\n    this.setupResume();\r\n  }\r\n\r\n  private setupKeyboardEvents(): void {\r\n    window.addEventListener('keydown', (e) => {\r\n      if (e.key.toLowerCase() === 'd') {\r\n        this.debugMode = !this.debugMode;\r\n      }\r\n    });\r\n  }\r\n\r\n  private setupResume(): void {\r\n    window.addEventListener('pointerdown', () => {\r\n      this.audioManager.resumeContext();\r\n    });\r\n\r\n    window.addEventListener('keydown', () => {\r\n      this.audioManager.resumeContext();\r\n    });\r\n  }\r\n\r\n  start(): void {\r\n    this.gameState.startRun();\r\n    \r\n    // Load audio assets\r\n    this.audioManager.loadAndCacheAudio('fire', '/audio/sfx/fire.mp3');\r\n    this.audioManager.loadAndCacheAudio('hit', '/audio/sfx/hit.mp3');\r\n    this.audioManager.loadAndCacheAudio('upgrade', '/audio/sfx/upgrade.mp3');\r\n    this.audioManager.loadAndCacheAudio('music', '/audio/music.mp3');\r\n    \r\n    // Start music after a short delay\r\n    window.setTimeout(() => {\r\n      this.audioManager.playMusicByKey('music', true);\r\n    }, 500);\r\n    \r\n    this.waveManager.startWave(1);\r\n    this.lastFrameTime = performance.now();\r\n    requestAnimationFrame(this.gameLoop.bind(this));\r\n  }\r\n\r\n  private gameLoop = (currentTime: number): void => {\r\n    const dt = Math.min((currentTime - this.lastFrameTime) / 1000, 0.016); // Cap at 60 FPS delta\r\n    this.lastFrameTime = currentTime;\r\n\r\n    const frameStartTime = performance.now();\r\n\r\n    // Update\r\n    this.update(dt);\r\n\r\n    // Render\r\n    this.render();\r\n\r\n    // Record metrics\r\n    const frameEndTime = performance.now();\r\n    const frameTime = frameEndTime - frameStartTime;\r\n    this.performanceMonitor.recordFrameTime(frameTime);\r\n    this.performanceMonitor.updateFps(currentTime);\r\n\r\n    // Next frame\r\n    requestAnimationFrame(this.gameLoop.bind(this));\r\n  };\r\n\r\n  private update(dt: number): void {\r\n    if (this.isGameOver) {\r\n      this.gameOverTimer += dt;\r\n      // Handle restart\r\n      const input = this.inputHandler.getInput();\r\n      if (input.fire && this.gameOverTimer > 1.0) {\r\n        this.restart();\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (!this.player?.alive) {\r\n      this.handleGameOver();\r\n      return;\r\n    }\r\n\r\n    // Reset damage tracking\r\n    this.damageCalculator.resetFrame();\r\n\r\n    // Wave management\r\n    this.waveManager.update(dt, this.enemyPool, this.renderer.getWidth());\r\n\r\n    if (this.waveManager.isWaveComplete()) {\r\n      this.waveTransitionTimer += dt;\r\n      this.showWaveTransition = true;\r\n      \r\n      // Fade in/out effect (0-0.5s fade in, 0.5-1.0s fade out)\r\n      if (this.waveTransitionTimer < 0.5) {\r\n        this.waveTransitionFade = this.waveTransitionTimer * 2; // 0 -> 1\r\n      } else {\r\n        this.waveTransitionFade = 2 - this.waveTransitionTimer * 2; // 1 -> 0\r\n      }\r\n\r\n      if (this.waveTransitionTimer >= 1.0) {\r\n        this.gameState.nextWave();\r\n        this.waveManager.startWave(this.gameState.wave);\r\n        this.waveTransitionTimer = 0;\r\n        this.showWaveTransition = false;\r\n      }\r\n      return; // Pause gameplay during transition\r\n    }\r\n\r\n    // Input (merge keyboard and touch)\r\n    this.touchControls.update();\r\n    const keyboardInput = this.inputHandler.getInput();\r\n    const touchInput = this.touchControls.input;\r\n    \r\n    const finalX = keyboardInput.x || touchInput.x;\r\n    const finalY = keyboardInput.y || touchInput.y;\r\n    const finalFire = keyboardInput.fire || touchInput.fire;\r\n    \r\n    this.player.updateInput(finalX, finalY);\r\n\r\n    // Constrain player to full screen (Chicken Invaders style - move anywhere!)\r\n    this.player.x = Math.max(this.player.radius, Math.min(this.renderer.getWidth() - this.player.radius, this.player.x));\r\n    this.player.y = Math.max(this.player.radius, Math.min(this.renderer.getHeight() - this.player.radius, this.player.y));\r\n\r\n    // Entity updates\r\n    this.player.update(dt);\r\n    this.enemyPool.update(dt);\r\n    this.bulletPool.update(dt);\r\n    this.lootManager.update(dt);\r\n    this.effectManager.update(dt);\r\n\r\n    // Collisions\r\n    this.handleCollisions();\r\n\r\n    // Loot collection\r\n    this.lootManager.collectLoot(this.player, (type, amount) => {\r\n      this.gameState.addResources(type, amount);\r\n      this.audioManager.playSfxByKey('upgrade'); // Collect sound\r\n    });\r\n\r\n    // Fire\r\n    if (finalFire && this.player.canFire()) {\r\n      this.player.fire();\r\n      this.audioManager.playSfxByKey('fire'); // Fire sound\r\n      const bullet = this.bulletPool.acquire(\r\n        this.player.x,\r\n        this.player.y,\r\n        Math.cos(this.player.aimAngle) * 300,\r\n        Math.sin(this.player.aimAngle) * 300,\r\n      );\r\n      if (bullet) {\r\n        bullet.resetWithType(\r\n          this.player.x,\r\n          this.player.y,\r\n          Math.cos(this.player.aimAngle) * 300,\r\n          Math.sin(this.player.aimAngle) * 300,\r\n          'player',\r\n        );\r\n      }\r\n    }\r\n\r\n    // Enemy firing\r\n    this.enemyPool.getActive().forEach((enemy) => {\r\n      if (enemy.canFire()) {\r\n        enemy.fire();\r\n        const angle = Math.atan2(this.player!.y - enemy.y, this.player!.x - enemy.x);\r\n        const bullet = this.bulletPool.acquire(\r\n          enemy.x,\r\n          enemy.y,\r\n          Math.cos(angle) * 200,\r\n          Math.sin(angle) * 200,\r\n        );\r\n        if (bullet) {\r\n          bullet.resetWithType(\r\n            enemy.x,\r\n            enemy.y,\r\n            Math.cos(angle) * 200,\r\n            Math.sin(angle) * 200,\r\n            'enemy',\r\n          );\r\n        }\r\n      }\r\n    });\r\n\r\n    // Remove out-of-bounds entities\r\n    this.removeOutOfBounds();\r\n  }\r\n\r\n  private handleCollisions(): void {\r\n    const playerBullets = this.bulletPool.getActive().filter((b) => b.bulletType === 'player');\r\n    const enemyBullets = this.bulletPool.getActive().filter((b) => b.bulletType === 'enemy');\r\n    const enemies = this.enemyPool.getActive();\r\n\r\n    // Player bullets vs enemies\r\n    playerBullets.forEach((bullet) => {\r\n      enemies.forEach((enemy) => {\r\n        const dx = bullet.x - enemy.x;\r\n        const dy = bullet.y - enemy.y;\r\n        const dist = Math.sqrt(dx * dx + dy * dy);\r\n        if (dist < bullet.radius + enemy.radius) {\r\n          this.damageCalculator.applyPlayerBulletDamage(bullet, enemy);\r\n          if (enemy.health <= 0) {\r\n            this.onEnemyDeath(enemy);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    // Enemy bullets vs player\r\n    if (this.player) {\r\n      enemyBullets.forEach((bullet) => {\r\n        const dx = bullet.x - this.player!.x;\r\n        const dy = bullet.y - this.player!.y;\r\n        const dist = Math.sqrt(dx * dx + dy * dy);\r\n        if (dist < bullet.radius + this.player!.radius) {\r\n          this.damageCalculator.applyEnemyBulletDamage(bullet, this.player!);\r\n          this.gameState.onPlayerHit();\r\n        }\r\n      });\r\n\r\n      // Enemy collision with player\r\n      enemies.forEach((enemy) => {\r\n        const dx = enemy.x - this.player!.x;\r\n        const dy = enemy.y - this.player!.y;\r\n        const dist = Math.sqrt(dx * dx + dy * dy);\r\n        if (dist < enemy.radius + this.player!.radius) {\r\n          this.damageCalculator.applyEnemyCollisionDamage(enemy, this.player!);\r\n          this.gameState.onPlayerHit();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private onEnemyDeath(enemy: Enemy): void {\r\n    this.gameState.addScore(100);\r\n    this.audioManager.playSfxByKey('hit'); // Enemy death sound\r\n    this.effectManager.spawnExplosion(enemy.x, enemy.y, COLORS.enemy, 8);\r\n    this.lootManager.spawnLoot(enemy.x, enemy.y, 'scrap', enemy.loot.scrap);\r\n    if (enemy.loot.synergy > 0) {\r\n      this.lootManager.spawnLoot(enemy.x, enemy.y, 'synergy', enemy.loot.synergy);\r\n    }\r\n    this.waveManager.onEnemyDeath();\r\n    enemy.alive = false;\r\n  }\r\n\r\n  private removeOutOfBounds(): void {\r\n    const width = this.renderer.getWidth();\r\n    const height = this.renderer.getHeight();\r\n\r\n    this.bulletPool.getActive().forEach((bullet) => {\r\n      if (bullet.x < -20 || bullet.x > width + 20 || bullet.y < -20 || bullet.y > height + 20) {\r\n        bullet.alive = false;\r\n      }\r\n    });\r\n\r\n    this.enemyPool.getActive().forEach((enemy) => {\r\n      if (enemy.y > height + 50) {\r\n        enemy.alive = false;\r\n        this.waveManager.onEnemyDeath();\r\n      }\r\n    });\r\n  }\r\n\r\n  private handleGameOver(): void {\r\n    this.isGameOver = true;\r\n    this.gameOverTimer = 0;\r\n    this.gameState.endRun();\r\n    this.audioManager.stopMusic(); // Stop music on game over\r\n  }\r\n\r\n  private restart(): void {\r\n    this.isGameOver = false;\r\n    this.gameOverTimer = 0;\r\n    this.waveTransitionTimer = 0;\r\n\r\n    // Reset pools\r\n    this.enemyPool.clear();\r\n    this.bulletPool.clear();\r\n    this.lootManager.clear();\r\n    this.effectManager.clear();\r\n\r\n    // Respawn player\r\n    this.player = this.playerPool.acquire(\r\n      this.renderer.getWidth() / 2,\r\n      this.renderer.getHeight() - 50,\r\n      0,\r\n      0,\r\n    );\r\n    if (this.player) {\r\n      this.player.reset(this.renderer.getWidth() / 2, this.renderer.getHeight() - 50);\r\n    }\r\n\r\n    // Restart game state\r\n    this.gameState.startRun();\r\n    this.waveManager.startWave(1);\r\n    \r\n    // Restart music\r\n    window.setTimeout(() => {\r\n      this.audioManager.playMusicByKey('music', true);\r\n    }, 200);\r\n  }\r\n\r\n  private render(): void {\r\n    this.renderer.clear();\r\n\r\n    // Draw loot\r\n    this.lootManager.draw(this.renderer.getContext());\r\n\r\n    // Draw effects (particles)\r\n    this.effectManager.draw(this.renderer.getContext());\r\n\r\n    // Draw entities\r\n    if (this.player?.alive) {\r\n      this.player.draw(this.renderer.getContext());\r\n    }\r\n    this.enemyPool.draw(this.renderer.getContext());\r\n    this.bulletPool.draw(this.renderer.getContext());\r\n\r\n    // Draw HUD\r\n    this.renderer.drawText(\r\n      `Wave: ${this.gameState.wave}`,\r\n      10,\r\n      20,\r\n      16,\r\n      COLORS.ui,\r\n    );\r\n    this.renderer.drawText(\r\n      `Score: ${this.gameState.score} (×${this.gameState.multiplier.toFixed(1)})`,\r\n      10,\r\n      40,\r\n      16,\r\n      COLORS.ui,\r\n    );\r\n    this.renderer.drawText(\r\n      `Scrap: ${this.gameState.resources.scrap} | Synergy: ${this.gameState.resources.synergy}`,\r\n      10,\r\n      60,\r\n      16,\r\n      COLORS.ui,\r\n    );\r\n\r\n    // Health bar\r\n    if (this.player) {\r\n      const healthPercent = this.player.health / this.player.maxHealth;\r\n      const barWidth = 150;\r\n      const barHeight = 10;\r\n      const barX = this.renderer.getWidth() - barWidth - 10;\r\n      const barY = 10;\r\n\r\n      const ctx = this.renderer.getContext();\r\n      ctx.fillStyle = '#333';\r\n      ctx.fillRect(barX, barY, barWidth, barHeight);\r\n      ctx.fillStyle = healthPercent > 0.5 ? '#00ff88' : healthPercent > 0.25 ? '#ffeb3b' : '#ff1744';\r\n      ctx.fillRect(barX, barY, barWidth * healthPercent, barHeight);\r\n      ctx.strokeStyle = '#fff';\r\n      ctx.strokeRect(barX, barY, barWidth, barHeight);\r\n\r\n      this.renderer.drawText(\r\n        `HP: ${this.player.health}/${this.player.maxHealth}`,\r\n        barX,\r\n        barY - 5,\r\n        12,\r\n        COLORS.ui,\r\n      );\r\n    }\r\n\r\n    // Wave Transition screen\r\n    if (this.showWaveTransition) {\r\n      const ctx = this.renderer.getContext();\r\n      ctx.save();\r\n      ctx.globalAlpha = this.waveTransitionFade;\r\n      ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\r\n      ctx.fillRect(0, 0, this.renderer.getWidth(), this.renderer.getHeight());\r\n\r\n      this.renderer.drawText(\r\n        `Wave ${this.gameState.wave + 1}`,\r\n        this.renderer.getWidth() / 2 - 60,\r\n        this.renderer.getHeight() / 2,\r\n        36,\r\n        COLORS.ship,\r\n      );\r\n      ctx.restore();\r\n    }\r\n\r\n    // Game Over screen\r\n    if (this.isGameOver) {\r\n      const ctx = this.renderer.getContext();\r\n      ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\r\n      ctx.fillRect(0, 0, this.renderer.getWidth(), this.renderer.getHeight());\r\n\r\n      this.renderer.drawText(\r\n        'GAME OVER',\r\n        this.renderer.getWidth() / 2 - 80,\r\n        this.renderer.getHeight() / 2 - 60,\r\n        32,\r\n        COLORS.warning,\r\n      );\r\n      this.renderer.drawText(\r\n        `Final Score: ${this.gameState.score}`,\r\n        this.renderer.getWidth() / 2 - 100,\r\n        this.renderer.getHeight() / 2 - 10,\r\n        20,\r\n        COLORS.ui,\r\n      );\r\n      this.renderer.drawText(\r\n        `Best Score: ${this.gameState.bestScore}`,\r\n        this.renderer.getWidth() / 2 - 90,\r\n        this.renderer.getHeight() / 2 + 20,\r\n        18,\r\n        COLORS.ui,\r\n      );\r\n      if (this.gameOverTimer > 1.0) {\r\n        this.renderer.drawText(\r\n          'Press SPACE to retry',\r\n          this.renderer.getWidth() / 2 - 95,\r\n          this.renderer.getHeight() / 2 + 60,\r\n          16,\r\n          COLORS.ship,\r\n        );\r\n      }\r\n    }\r\n\r\n    // Draw touch controls (mobile)\r\n    this.touchControls.draw(this.renderer.getContext());\r\n\r\n    // Debug HUD\r\n    if (this.debugMode) {\r\n      this.renderer.drawText(\r\n        `FPS: ${this.performanceMonitor.getFps()}`,\r\n        10,\r\n        this.renderer.getHeight() - 80,\r\n        14,\r\n        COLORS.warning,\r\n      );\r\n      this.renderer.drawText(\r\n        `P95: ${this.performanceMonitor.getP95FrameTime().toFixed(2)}ms`,\r\n        10,\r\n        this.renderer.getHeight() - 60,\r\n        14,\r\n        COLORS.warning,\r\n      );\r\n      this.renderer.drawText(\r\n        `Entities: ${this.enemyPool.getActive().length + this.bulletPool.getActive().length + this.lootManager.getActiveLoot().length + this.effectManager.getParticleCount()}`,\r\n        10,\r\n        this.renderer.getHeight() - 40,\r\n        14,\r\n        COLORS.warning,\r\n      );\r\n      this.renderer.drawText(\r\n        `Wave Progress: ${this.waveManager.getWaveProgress().alive}/${this.waveManager.getWaveProgress().total}`,\r\n        10,\r\n        this.renderer.getHeight() - 20,\r\n        14,\r\n        COLORS.warning,\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\n// Initialize on DOM ready\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  const game = new Game();\r\n  game.start();\r\n});\r\n"],"names":["COLORS","INPUT","AUDIO","ENTITY","Renderer","canvas","ctx","dpr","width","height","constructor","canvasId","document","getElementById","Error","this","getContext","window","devicePixelRatio","clientWidth","clientHeight","scale","style","clear","fillStyle","fillRect","drawTriangle","x","y","size","angle","fillColor","save","translate","rotate","beginPath","moveTo","lineTo","closePath","fill","restore","drawCircle","radius","arc","Math","PI","drawRect","drawText","text","color","font","textAlign","fillText","drawTextCentered","getWidth","getHeight","GameState","wave","score","multiplier","comboCounter","noHitWave","resources","scrap","synergy","rare","workshopUpgrades","Map","isRunActive","bestScore","runCount","loadWorkshopUpgrades","loadRunStats","startRun","saveRunStats","endRun","nextWave","min","floor","onPlayerHit","addScore","points","addResources","type","amount","addWorkshopUpgrade","upgrade","set","id","getUpgrade","get","saveWorkshopUpgrades","data","Array","from","values","localStorage","setItem","JSON","stringify","e","getItem","upgrades","parse","forEach","clearRun","stats","InputHandler","keyPressed","Set","gamepadState","fire","pointerState","active","touchIdentifier","setupKeyboardListeners","setupPointerListeners","addEventListener","add","key","toLowerCase","delete","handlePointerStart","handlePointerMove","handlePointerEnd","touches","length","identifier","clientX","clientY","isPrimary","pollGamepad","gamepads","navigator","getGamepads","gamepad","connected","deadzone","magnitude","sqrt","normalized","atan2","cos","sin","applyDeadzone","axes","buttons","pressed","getInput","kx","ky","has","kFire","mag","rect","getBoundingClientRect","canvasCenterX","canvasCenterY","px","left","py","top","isKeyPressed","shutdown","AudioManager","audioContext","masterGain","musicGain","sfxGain","sfxPool","available","playing","musicSource","contextResumeAttempted","buffers","musicBaseGain","musicDuckedGain","duckingRampTime","tryInitContext","AudioContext","webkitAudioContext","createGain","gain","value","connect","destination","i","source","createBufferSource","push","resumeContext","state","resume","loadAudio","url","response","fetch","arrayBuffer","decodeAudioData","loadAndCacheAudio","buffer","playSfx","pop","applyMusicDucking","onended","start","playSfxByKey","duck","targetGain","currentTime","cancelScheduledValues","setValueAtTime","exponentialRampToValueAtTime","playMusic","loop","stop","playMusicByKey","stopMusic","setMasterGain","max","getMasterGain","getContextState","CollisionSystem","pairs","checkCollisions","entities","alive","j","checkCollision","a","b","x1","y1","r1","x2","y2","r2","dx","dy","checkCircleCollision","getPairs","Entity","vx","vy","reset","deactivate","update","dt","draw","getBoundingBox","EntityPool","pool","entityFactory","factory","acquire","entity","release","index","indexOf","splice","getActive","Player","health","maxHealth","fireRate","timeSinceLastFire","aimAngle","maxSpeed","acceleration","deceleration","fireFlash","damageFlashTimer","targetVx","targetVy","super","dvx","dvy","abs","accelRate","sign","decelRate","updateInput","inputX","inputY","inputMag","canFire","takeDamage","shadowColor","shadowBlur","damageFlashing","strokeStyle","lineWidth","stroke","Enemy","faction","loot","aiTimer","aiAngle","baseSpeed","deathAnimTimer","isDying","assignFactionStats","updateAI","random","progress","globalAlpha","shouldFlash","drawSquare","drawHexagon","drawDiamond","strokeRect","Bullet","bulletType","lifetime","timeAlive","resetWithType","PerformanceMonitor","frameTimes","fpsCounter","lastFpsUpdate","currentFps","maxFrameTimeP95","maxSamples","recordFrameTime","deltaTime","shift","updateFps","calculateP95","sorted","sort","p95Index","ceil","getFps","getP95FrameTime","getAverageFrameTime","reduce","isFrameBudgetExceeded","threshold","logMetrics","toFixed","WaveManager","currentWave","enemiesSpawned","enemiesAlive","spawnTimer","waveComplete","waveActive","currentPatternIndex","patternSpawnCount","waveDefinitions","setupWaveDefinitions","patterns","count","spawnDelay","totalEnemies","startWave","waveNum","enemyPool","canvasWidth","waveDef","currentPattern","spawnX","spawnY","enemy","onEnemyDeath","isWaveComplete","isWaveActive","getWaveNumber","getWaveProgress","spawned","total","LootManager","lootDrops","PICKUP_RANGE","MAX_LIFETIME","spawnLoot","maxLifetime","lootType","nx","ny","nvx","nvy","filter","collectLoot","player","onCollect","collectRange","getActiveLoot","DamageCalculator","damageThisFrame","resetFrame","applyPlayerBulletDamage","bullet","applyEnemyBulletDamage","applyEnemyCollisionDamage","EffectManager","particles","MAX_PARTICLES","spawnExplosion","speed","particle","p","alpha","getParticleCount","TouchControls","joystickActive","joystickStartX","joystickStartY","joystickCurrentX","joystickCurrentY","joystickRadius","joystickMaxDistance","fireButtonActive","touchIdJoystick","touchIdFire","input","setupEventListeners","handleTouchStart","bind","passive","handleTouchMove","handleTouchEnd","touchEvent","preventDefault","changedTouches","touch","distance","clampedDistance","fireX","fireY","Game","renderer","gameState","inputHandler","touchControls","audioManager","collisionSystem","performanceMonitor","waveManager","lootManager","damageCalculator","effectManager","playerPool","bulletPool","debugMode","lastFrameTime","waveTransitionTimer","gameOverTimer","isGameOver","showWaveTransition","waveTransitionFade","setupKeyboardEvents","setupResume","setTimeout","performance","now","requestAnimationFrame","gameLoop","frameStartTime","render","frameTime","restart","handleGameOver","keyboardInput","touchInput","finalX","finalY","finalFire","handleCollisions","removeOutOfBounds","playerBullets","enemyBullets","enemies","healthPercent","barWidth","barHeight","barX","barY"],"mappings":"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"}